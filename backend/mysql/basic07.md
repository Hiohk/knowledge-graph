---
prev:
  text: "多表查询"
  link: "/backend/mysql/basic06"
next:
  text: "聚合函数"
  link: "/backend/mysql/basic08"
---

# 第 07 章 单行函数

## 1. 函数的理解

### 1.1 什么是函数

函数在计算机语言的使用中贯穿始终，函数的作用是什么呢？它可以把我们经常使用的代码封装起来，
需要的时候直接调用即可。这样既 提高了代码效率 ，又 提高了可维护性 。在 SQL 中我们也可以使用函数
对检索出来的数据进行函数操作。使用这些函数，可以极大地 提高用户对数据库的管理效率 。

从函数定义的角度出发，我们可以将函数分成 内置函数 和 自定义函数 。在 SQL 语言中，同样也包括了
内置函数和自定义函数。内置函数是系统内置的通用函数，而自定义函数是我们根据自己的需要编写
的，本章及下一章讲解的是 SQL 的内置函数。

### 1.2 不同 DBMS 函数的差异

我们在使用 SQL 语言的时候，不是直接和这门语言打交道，而是通过它使用不同的数据库软件，即
DBMS。**DBMS 之间的差异性很大，远大于同一个语言不同版本之间的差异**。实际上，只有很少的函数是
被 DBMS 同时支持的。比如，大多数 DBMS 使用（||）或者（+）来做拼接符，而在 MySQL 中的字符串拼
接函数为 concat()。大部分 DBMS 会有自己特定的函数，这就意味着**采用 SQL 函数的代码可移植性是很差的**，因此在使用函数的时候需要特别注意。

### 1.3 MySQL 的内置函数及分类

MySQL 提供了丰富的内置函数，这些函数使得数据的维护与管理更加方便，能够更好地提供数据的分析与统计功能，在一定程度上提高了开发人员进行数据分析与统计的效率。

MySQL 提供的内置函数从 实现的功能角度 可以分为数值函数、字符串函数、日期和时间函数、流程控制函数、加密与解密函数、获取 MySQL 信息函数、聚合函数等。这里，我将这些丰富的内置函数再分为两类： 单行函数 、 聚合函数（或分组函数）。

**两种 SQL 函数**

![alt text](image01/image59.png)

**单行函数**

- 操作数据对象
- 接受参数返回一个结果
- 只对一行进行变换
- 每行返回一个结果
- 可以嵌套
- 参数可以是一列或一个值

## 2. 数值函数

### 2.1 基本函数

| 函数                | 用法                                                                    |
| ------------------- | ----------------------------------------------------------------------- |
| ABS(x)              | 返回 x 的绝对值                                                         |
| SIGN(X)             | 返回 X 的符号。正数返回 1，负数返回-1，0 返回 0                         |
| PI()                | 返回圆周率的值                                                          |
| CEIL(x)，CEILING(x) | 返回大于或等于某个值的最小整数                                          |
| FLOOR(x)            | 返回小于或等于某个值的最大整数                                          |
| LEAST(e1,e2,e3…)    | 返回列表中的最小值                                                      |
| GREATEST(e1,e2,e3…) | 返回列表中的最大值                                                      |
| MOD(x,y)            | 返回 X 除以 Y 后的余数                                                  |
| RAND()              | 返回 0~1 的随机值                                                       |
| RAND(x)             | 返回 0~1 的随机值，其中 x 的值用作种子值，相同的 X 值会产生相同的随机数 |
| ROUND(x)            | 返回一个对 x 的值进行四舍五入后，最接近于 X 的整数                      |
| ROUND(x,y)          | 返回一个对 x 的值进行四舍五入后最接近 X 的值，并保留到小数点后面 Y 位   |
| TRUNCATE(x,y)       | 返回数字 x 截断为 y 位小数的结果                                        |
| SQRT(x)             | 返回 x 的平方根。当 X 的值为负数时，返回 NULL                           |

举例：

```shell
SELECT
ABS(-123),ABS(32),SIGN(-23),SIGN(43),PI(),CEIL(32.32),CEILING(-43.23),FLOOR(32.32),
FLOOR(-43.23),MOD(12,5)
FROM DUAL;
```

```shell
SELECT RAND(),RAND(),RAND(10),RAND(10),RAND(-1),RAND(-1)
FROM DUAL;
```

```shell
SELECT
ROUND(12.33),ROUND(12.343,2),ROUND(12.324,-1),TRUNCATE(12.66,1),TRUNCATE(12.66,-1)
FROM DUAL;
```

### 2.2 角度与弧度互换函数

| 函数       | 用法                                    |
| ---------- | --------------------------------------- |
| RADIANS(x) | 将角度转化为弧度，其中，参数 x 为角度值 |
| DEGREES(x) | 将弧度转化为角度，其中，参数 x 为弧度值 |

```shell
SELECT RADIANS(30),RADIANS(60),RADIANS(90),DEGREES(2*PI()),DEGREES(RADIANS(90))
FROM DUAL;
```

### 2.3 三角函数

| 函数         | 用法                                                                             |
| ------------ | -------------------------------------------------------------------------------- |
| SIN(x)       | 返回 x 的正弦值，其中，参数 x 为弧度值                                           |
| ASIN(x)      | 返回 x 的反正弦值，即获取正弦为 x 的值。如果 x 的值不在-1 到 1 之间，则返回 NULL |
| COS(x)       | 返回 x 的余弦值，其中，参数 x 为弧度值                                           |
| ACOS(x)      | 返回 x 的反余弦值，即获取余弦为 x 的值。如果 x 的值不在-1 到 1 之间，则返回 NULL |
| TAN(x)       | 返回- x 的正切值，其中，参数 x 为弧度值                                          |
| ATAN(x) 返回 | x 的反正切值，即返回正切值为 x 的值                                              |
| ATAN2(m,n)   | 返回两个参数的反正切值                                                           |
| COT(x)       | 返回 x 的余切值，其中，X 为弧度值                                                |

举例：

ATAN2(M,N)函数返回两个参数的反正切值。 与 ATAN(X)函数相比，ATAN2(M,N)需要两个参数，例如有两个
点 point(x1,y1)和 point(x2,y2)，使用 ATAN(X)函数计算反正切值为 ATAN((y2-y1)/(x2-x1))，使用 ATAN2(M,N)计
算反正切值则为 ATAN2(y2-y1,x2-x1)。由使用方式可以看出，当 x2-x1 等于 0 时，ATAN(X)函数会报错，而 ATAN2(M,N)函数则仍然可以计算。

ATAN2(M,N)函数的使用示例如下：

```shell
SELECT
SIN(RADIANS(30)),DEGREES(ASIN(1)),TAN(RADIANS(45)),
DEGREES(ATAN(1)),DEGREES(ATAN2(1,1)
)
FROM DUAL;
```

### 2.4 指数与对数

| 函数                 | 用法                                                       |
| -------------------- | ---------------------------------------------------------- |
| POW(x,y)，POWER(X,Y) | 返回 x 的 y 次方                                           |
| EXP(X)               | 返回 e 的 X 次方，其中 e 是一个常数，2.718281828459045     |
| LN(X)，LOG(X)        | 返回以 e 为底的 X 的对数，当 X <= 0 时，返回的结果为 NULL  |
| LOG10(X)             | 返回以 10 为底的 X 的对数，当 X <= 0 时，返回的结果为 NULL |
| LOG2(X)              | 返回以 2 为底的 X 的对数，当 X <= 0 时，返回 NULL          |

```shell
mysql> SELECT POW(2,5),POWER(2,4),EXP(2),LN(10),LOG10(10),LOG2(4)
-> FROM DUAL;
+----------+------------+------------------+-------------------+-----------+---------+
| POW(2,5) | POWER(2,4) | EXP(2) | LN(10) | LOG10(10) | LOG2(4) |
+----------+------------+------------------+-------------------+-----------+---------+
| 32 | 16 | 7.38905609893065 | 2.302585092994046 | 1 | 2 |
+----------+------------+------------------+-------------------+-----------+---------+
1 row in set (0.00 sec)
```

### 2.5 进制间的转换

| 函数          | 用法                         |
| ------------- | ---------------------------- |
| BIN(x)        | 返回 x 的二进制编码          |
| HEX(x)        | 返回 x 的十六进制编码        |
| OCT(x)        | 返回 x 的八进制编码          |
| CONV(x,f1,f2) | 返回 f1 进制数变成 f2 进制数 |

```shell
mysql> SELECT BIN(10),HEX(10),OCT(10),CONV(10,2,8)
-> FROM DUAL;
+---------+---------+---------+--------------+
| BIN(10) | HEX(10) | OCT(10) | CONV(10,2,8) |
+---------+---------+---------+--------------+
| 1010 | A | 12 | 2 |
+---------+---------+---------+--------------+
1 row in set (0.00 sec)
```

## 3. 字符串函数

| 函数                              | 用法                                                                                                                  |
| --------------------------------- | --------------------------------------------------------------------------------------------------------------------- |
| ASCII(S)                          | 返回字符串 S 中的第一个字符的 ASCII 码值                                                                              |
| CHAR_LENGTH(s)                    | 返回字符串 s 的字符数。作用与 CHARACTER_LENGTH(s)相同                                                                 |
| LENGTH(s)                         | 返回字符串 s 的字节数，和字符集有关                                                                                   |
| CONCAT(s1,s2,......,sn)           | 连接 s1,s2,......,sn 为一个字符串                                                                                     |
| CONCAT_WS(x,s1,s2,......,sn)      | 同 CONCAT(s1,s2,...)函数，但是每个字符串之间要加上 x                                                                  |
| INSERT(str, idx, len, replacestr) | 将字符串 str 从第 idx 位置开始，len 个字符长的子串替换为字符串 replacestr                                             |
| REPLACE(str, a, b)                | 用字符串 b 替换字符串 str 中所有出现的字符串 a                                                                        |
| UPPER(s) 或 UCASE(s)              | 将字符串 s 的所有字母转成大写字母                                                                                     |
| LOWER(s) 或 LCASE(s)              | 将字符串 s 的所有字母转成小写字母                                                                                     |
| LEFT(str,n)                       | 返回字符串 str 最左边的 n 个字符                                                                                      |
| RIGHT(str,n)                      | 返回字符串 str 最右边的 n 个字符                                                                                      |
| LPAD(str, len, pad)               | 用字符串 pad 对 str 最左边进行填充，直到 str 的长度为 len 个字符                                                      |
| RPAD(str ,len, pad)               | 用字符串 pad 对 str 最右边进行填充，直到 str 的长度为 len 个字符                                                      |
| LTRIM(s)                          | 去掉字符串 s 左侧的空格                                                                                               |
| RTRIM(s)                          | 去掉字符串 s 右侧的空格                                                                                               |
| TRIM(s)                           | 去掉字符串 s 开始与结尾的空格                                                                                         |
| TRIM(s1 FROM s)                   | 去掉字符串 s 开始与结尾的 s1                                                                                          |
| TRIM(LEADING s1 FROM s)           | 去掉字符串 s 开始处的 s1                                                                                              |
| TRIM(TRAILING s1 FROM s)          | 去掉字符串 s 结尾处的 s1                                                                                              |
| REPEAT(str, n)                    | 返回 str 重复 n 次的结果                                                                                              |
| SPACE(n)                          | 返回 n 个空格                                                                                                         |
| STRCMP(s1,s2)                     | 比较字符串 s1,s2 的 ASCII 码值的大小                                                                                  |
| SUBSTR(s,index,len)               | 返回从字符串 s 的 index 位置其 len 个字符，作用与 SUBSTRING(s,n,len)、MID(s,n,len)相同                                |
| LOCATE(substr,str)                | 返回字符串 substr 在字符串 str 中首次出现的位置，作用于 POSITION(substrIN str)、INSTR(str,substr)相同。未找到，返回 0 |
| ELT(m,s1,s2,…,sn)                 | 返回指定位置的字符串，如果 m=1，则返回 s1，如果 m=2，则返回 s2，如果 m=n，则返回 sn                                   |
| FIELD(s,s1,s2,…,sn)               | 返回字符串 s 在字符串列表中第一次出现的位置                                                                           |
| FIND_IN_SET(s1,s2)                | 返回字符串 s1 在字符串 s2 中出现的位置。其中，字符串 s2 是一个以逗号分隔的字符串                                      |
| REVERSE(s)                        | 返回 s 反转后的字符串                                                                                                 |
| NULLIF(value1,value2)             | 比较两个字符串，如果 value1 与 value2 相等，则返回 NULL，否则返回 value1                                              |

> 注意：MySQL 中，字符串的位置是从 1 开始的。

举例：

```shell
mysql> SELECT FIELD('mm','hello','msm','amma'),FIND_IN_SET('mm','hello,mm,amma')
-> FROM DUAL;
+----------------------------------+-----------------------------------+
| FIELD('mm','hello','msm','amma') | FIND_IN_SET('mm','hello,mm,amma') |
+----------------------------------+-----------------------------------+
| 0 | 2 |
+----------------------------------+-----------------------------------+
1 row in set (0.00 sec)
mysql> SELECT NULLIF('mysql','mysql'),NULLIF('mysql', '');
+-------------------------+---------------------+
| NULLIF('mysql','mysql') | NULLIF('mysql', '') |
+-------------------------+---------------------+
| NULL | mysql |
+-------------------------+---------------------+
1 row in set (0.00 sec)
```

## 4. 日期和时间函数

### 4.1 获取日期、时间

### 4.2 日期与时间戳的转换

### 4.3 获取月份、星期、星期数、天数等函数

### 4.4 日期的操作函数

### 4.5 时间和秒钟转换的函数

### 4.6 计算日期和时间的函数

### 4.7 日期的格式化与解析

## 5. 流程控制函数

## 6. 加密与解密函数

## 7. MySQL 信息函数

## 8. 其他函数

<a-back-top />

<reading-progress-bar/>
